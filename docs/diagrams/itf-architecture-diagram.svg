<svg width="1400" height="1050" xmlns="http://www.w3.org/2000/svg" font-family="Segoe UI, Arial, sans-serif">
  <defs>
    <style>
      .region       { fill:#f8f9fa; stroke:#6c757d; stroke-width:2; rx:8; }
      .vpc          { fill:#e8f0fe; stroke:#1a73e8; stroke-width:1.5; stroke-dasharray:6,3; rx:6; }
      .pub-subnet   { fill:#d4edda; stroke:#28a745; stroke-width:1.5; rx:5; }
      .priv-subnet  { fill:#fff8e1; stroke:#f9a825; stroke-width:1.5; rx:5; }
      .box          { fill:#fff; stroke:#495057; stroke-width:1.2; rx:4; }
      .box-alb      { fill:#fff; stroke:#8c4fff; stroke-width:1.5; rx:4; }
      .box-fargate  { fill:#ff9900; stroke:#cc7a00; stroke-width:1.2; rx:4; }
      .box-rds      { fill:#527fff; stroke:#3a5fcc; stroke-width:1.2; rx:4; }
      .box-r53      { fill:#8c4fff; stroke:#6a3bcc; stroke-width:1.2; rx:4; }
      .box-s3       { fill:#569a31; stroke:#3d7222; stroke-width:1.2; rx:4; }
      .box-acm      { fill:#dd344c; stroke:#b02a3d; stroke-width:1.2; rx:4; }
      .box-vpce     { fill:#945bb4; stroke:#6d3f87; stroke-width:1.2; rx:4; }
      .box-cw       { fill:#e8334c; stroke:#c02a3f; stroke-width:1.2; rx:4; }
      .box-user     { fill:#4285f4; stroke:#2b6bd6; stroke-width:1.2; rx:4; }
      .box-tf       { fill:#7b42bc; stroke:#5c2e91; stroke-width:1.2; rx:4; }

      .t-title      { font-size:20px; font-weight:700; fill:#212529; }
      .t-sub        { font-size:12px; fill:#6c757d; }
      .t-region     { font-size:14px; font-weight:700; fill:#495057; }
      .t-label      { font-size:11px; font-weight:600; fill:#fff; }
      .t-label-dk   { font-size:11px; font-weight:600; fill:#212529; }
      .t-detail     { font-size:9px; fill:#fff; }
      .t-detail-dk  { font-size:9px; fill:#495057; }
      .t-subnet     { font-size:10px; font-weight:600; fill:#495057; }
      .t-legend     { font-size:10px; fill:#495057; }
      .t-legend-h   { font-size:11px; font-weight:700; fill:#212529; }
      .t-cost       { font-size:9px; fill:#495057; }

      .arrow        { fill:none; stroke:#495057; stroke-width:1.8; marker-end:url(#ah); }
      .arrow-blue   { stroke:#1a73e8; marker-end:url(#ah-blue); }
      .arrow-green  { stroke:#28a745; marker-end:url(#ah-green); }
      .arrow-red    { stroke:#dc3545; stroke-width:2.2; marker-end:url(#ah-red); }
      .arrow-orange { stroke:#ff9900; marker-end:url(#ah-orange); }
      .arrow-dash   { stroke-dasharray:5,4; }
      .arrow-repl   { stroke:#1a73e8; stroke-width:2; stroke-dasharray:8,4; marker-end:url(#ah-blue); }
    </style>
    <marker id="ah" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#495057"/></marker>
    <marker id="ah-blue" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#1a73e8"/></marker>
    <marker id="ah-green" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#28a745"/></marker>
    <marker id="ah-red" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#dc3545"/></marker>
    <marker id="ah-orange" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#ff9900"/></marker>
  </defs>

  <!-- ================================================================ -->
  <!-- TITLE                                                            -->
  <!-- ================================================================ -->
  <text x="700" y="32" text-anchor="middle" class="t-title">ITF Masters Tour — AWS DR Architecture</text>
  <text x="700" y="50" text-anchor="middle" class="t-sub">Fargate • ALB • RDS PostgreSQL • Route 53 Failover • VPC Endpoints • Terraform</text>

  <!-- ================================================================ -->
  <!-- GLOBAL SERVICES (above regions)                                  -->
  <!-- ================================================================ -->

  <!-- User -->
  <rect x="30" y="72" width="120" height="52" class="box-user"/>
  <text x="90" y="94" text-anchor="middle" class="t-label">Web Browser</text>
  <text x="90" y="108" text-anchor="middle" class="t-detail">Tennis Admin / Players</text>

  <!-- Route 53 -->
  <rect x="230" y="72" width="150" height="52" class="box-r53"/>
  <text x="305" y="92" text-anchor="middle" class="t-label">Route 53</text>
  <text x="305" y="106" text-anchor="middle" class="t-detail">awscloudcase.com</text>

  <!-- ACM -->
  <rect x="440" y="72" width="110" height="52" class="box-acm"/>
  <text x="495" y="92" text-anchor="middle" class="t-label">ACM</text>
  <text x="495" y="106" text-anchor="middle" class="t-detail">TLS Certificate</text>

  <!-- S3 -->
  <rect x="610" y="72" width="140" height="52" class="box-s3"/>
  <text x="680" y="92" text-anchor="middle" class="t-label">S3</text>
  <text x="680" y="106" text-anchor="middle" class="t-detail">Evidence &amp; Artifacts</text>

  <!-- Terraform -->
  <rect x="810" y="72" width="130" height="52" class="box-tf"/>
  <text x="875" y="92" text-anchor="middle" class="t-label">Terraform</text>
  <text x="875" y="106" text-anchor="middle" class="t-detail">Infrastructure as Code</text>

  <!-- Arrows: User → Route53 -->
  <line x1="150" y1="98" x2="228" y2="98" class="arrow arrow-blue"/>
  <text x="189" y="92" text-anchor="middle" class="t-detail-dk">DNS</text>

  <!-- Arrow: ACM → Route53 (provides cert) -->
  <line x1="440" y1="98" x2="382" y2="98" class="arrow arrow-dash" style="stroke:#dd344c; marker-end:url(#ah-red)"/>

  <!-- ================================================================ -->
  <!-- PRIMARY REGION                                                   -->
  <!-- ================================================================ -->
  <rect x="30" y="148" width="640" height="530" class="region"/>
  <text x="50" y="172" class="t-region">Primary Region — us-east-1</text>

  <!-- VPC -->
  <rect x="50" y="185" width="600" height="478" class="vpc"/>
  <text x="68" y="205" class="t-subnet" style="fill:#1a73e8;">VPC</text>

  <!-- Public Subnet -->
  <rect x="70" y="215" width="260" height="105" class="pub-subnet"/>
  <text x="82" y="233" class="t-subnet">Public Subnet (AZ1 + AZ2)</text>

  <!-- ALB -->
  <rect x="90" y="245" width="220" height="58" class="box-alb"/>
  <text x="200" y="267" text-anchor="middle" class="t-label-dk">Application Load Balancer</text>
  <text x="200" y="281" text-anchor="middle" class="t-detail-dk">HTTPS :443 → target group</text>

  <!-- Private Subnet App -->
  <rect x="70" y="335" width="260" height="130" class="priv-subnet"/>
  <text x="82" y="353" class="t-subnet">Private Subnet — App (AZ1 + AZ2)</text>

  <!-- Fargate -->
  <rect x="90" y="365" width="220" height="82" class="box-fargate"/>
  <text x="200" y="387" text-anchor="middle" class="t-label">Fargate Task</text>
  <text x="200" y="401" text-anchor="middle" class="t-detail">Flask Container</text>
  <text x="200" y="414" text-anchor="middle" class="t-detail">0.25 vCPU · 0.5 GB</text>
  <text x="200" y="427" text-anchor="middle" class="t-detail">20 routes · Jinja2 · Admin Panel</text>

  <!-- Private Subnet DB -->
  <rect x="70" y="480" width="260" height="105" class="priv-subnet"/>
  <text x="82" y="498" class="t-subnet">Private Subnet — DB (AZ1 + AZ2)</text>

  <!-- RDS Primary -->
  <rect x="90" y="510" width="220" height="60" class="box-rds"/>
  <text x="200" y="532" text-anchor="middle" class="t-label">RDS PostgreSQL 16</text>
  <text x="200" y="546" text-anchor="middle" class="t-detail">db.t4g.micro · Multi-AZ · Primary</text>
  <text x="200" y="558" text-anchor="middle" class="t-detail">24 tables · itf_tournament</text>

  <!-- VPC Endpoints -->
  <rect x="365" y="335" width="270" height="250" class="priv-subnet"/>
  <text x="377" y="353" class="t-subnet">VPC Endpoints (no NAT Gateway)</text>

  <rect x="385" y="370" width="110" height="40" class="box-vpce"/>
  <text x="440" y="388" text-anchor="middle" class="t-detail" style="font-weight:600;">VPCE: Secrets Mgr</text>
  <text x="440" y="400" text-anchor="middle" class="t-detail">Interface</text>

  <rect x="510" y="370" width="110" height="40" class="box-vpce"/>
  <text x="565" y="388" text-anchor="middle" class="t-detail" style="font-weight:600;">VPCE: Logs</text>
  <text x="565" y="400" text-anchor="middle" class="t-detail">Interface</text>

  <rect x="385" y="425" width="110" height="40" class="box-vpce"/>
  <text x="440" y="443" text-anchor="middle" class="t-detail" style="font-weight:600;">VPCE: ECR</text>
  <text x="440" y="455" text-anchor="middle" class="t-detail">Interface</text>

  <rect x="510" y="425" width="110" height="40" class="box-vpce"/>
  <text x="565" y="443" text-anchor="middle" class="t-detail" style="font-weight:600;">VPCE: S3</text>
  <text x="565" y="455" text-anchor="middle" class="t-detail">Gateway (FREE)</text>

  <!-- CloudWatch primary -->
  <rect x="385" y="490" width="235" height="45" class="box-cw"/>
  <text x="502" y="510" text-anchor="middle" class="t-label">CloudWatch</text>
  <text x="502" y="524" text-anchor="middle" class="t-detail">Logs · Metrics · Health Check Alarm</text>

  <!-- Secrets Manager primary -->
  <rect x="385" y="548" width="235" height="30" class="box" style="fill:#fce4ec; stroke:#dd344c;"/>
  <text x="502" y="568" text-anchor="middle" class="t-detail-dk" style="font-weight:600;">Secrets Manager — DB Credentials</text>

  <!-- Arrows inside primary -->
  <!-- Route53 → ALB primary (green = active) -->
  <path d="M 305 124 L 305 140 Q 305 148 200 200 L 200 243" class="arrow arrow-green"/>
  <text x="225" y="168" class="t-detail-dk" style="fill:#28a745; font-weight:600;">Active</text>

  <!-- ALB → Fargate -->
  <line x1="200" y1="303" x2="200" y2="363" class="arrow"/>

  <!-- Fargate → RDS -->
  <line x1="200" y1="447" x2="200" y2="508" class="arrow"/>
  <text x="212" y="482" class="t-detail-dk">SQL</text>

  <!-- Fargate → VPCE area -->
  <line x1="310" y1="406" x2="383" y2="406" class="arrow arrow-orange"/>

  <!-- ================================================================ -->
  <!-- DR REGION                                                        -->
  <!-- ================================================================ -->
  <rect x="730" y="148" width="640" height="530" class="region"/>
  <text x="750" y="172" class="t-region">DR Region — us-west-2</text>

  <!-- VPC DR -->
  <rect x="750" y="185" width="600" height="478" class="vpc"/>
  <text x="768" y="205" class="t-subnet" style="fill:#1a73e8;">VPC</text>

  <!-- Public Subnet DR -->
  <rect x="770" y="215" width="260" height="105" class="pub-subnet"/>
  <text x="782" y="233" class="t-subnet">Public Subnet (AZ1 + AZ2)</text>

  <!-- ALB DR -->
  <rect x="790" y="245" width="220" height="58" class="box-alb" opacity="0.55"/>
  <text x="900" y="267" text-anchor="middle" class="t-label-dk">Application Load Balancer</text>
  <text x="900" y="281" text-anchor="middle" class="t-detail-dk">Standby</text>

  <!-- Private Subnet App DR -->
  <rect x="770" y="335" width="260" height="130" class="priv-subnet"/>
  <text x="782" y="353" class="t-subnet">Private Subnet — App (AZ1 + AZ2)</text>

  <!-- Fargate DR -->
  <rect x="790" y="365" width="220" height="82" class="box-fargate" opacity="0.55"/>
  <text x="900" y="387" text-anchor="middle" class="t-label">Fargate Task</text>
  <text x="900" y="401" text-anchor="middle" class="t-detail">Flask Container</text>
  <text x="900" y="414" text-anchor="middle" class="t-detail">0.25 vCPU · 0.5 GB</text>
  <text x="900" y="427" text-anchor="middle" class="t-detail">Standby · Activated on Failover</text>

  <!-- Private Subnet DB DR -->
  <rect x="770" y="480" width="260" height="105" class="priv-subnet"/>
  <text x="782" y="498" class="t-subnet">Private Subnet — DB (AZ1 + AZ2)</text>

  <!-- RDS Replica DR -->
  <rect x="790" y="510" width="220" height="60" class="box-rds" opacity="0.65"/>
  <text x="900" y="532" text-anchor="middle" class="t-label">RDS PostgreSQL 16</text>
  <text x="900" y="546" text-anchor="middle" class="t-detail">Read Replica</text>
  <text x="900" y="558" text-anchor="middle" class="t-detail">→ Promoted on Failover</text>

  <!-- VPC Endpoints DR -->
  <rect x="1065" y="335" width="270" height="170" class="priv-subnet"/>
  <text x="1077" y="353" class="t-subnet">VPC Endpoints (mirrors primary)</text>

  <rect x="1085" y="370" width="110" height="40" class="box-vpce" opacity="0.55"/>
  <text x="1140" y="388" text-anchor="middle" class="t-detail" style="font-weight:600;">VPCE: Secrets Mgr</text>
  <text x="1140" y="400" text-anchor="middle" class="t-detail">Interface</text>

  <rect x="1210" y="370" width="110" height="40" class="box-vpce" opacity="0.55"/>
  <text x="1265" y="388" text-anchor="middle" class="t-detail" style="font-weight:600;">VPCE: Logs</text>
  <text x="1265" y="400" text-anchor="middle" class="t-detail">Interface</text>

  <rect x="1085" y="425" width="110" height="40" class="box-vpce" opacity="0.55"/>
  <text x="1140" y="443" text-anchor="middle" class="t-detail" style="font-weight:600;">VPCE: ECR</text>
  <text x="1140" y="455" text-anchor="middle" class="t-detail">Interface</text>

  <rect x="1210" y="425" width="110" height="40" class="box-vpce" opacity="0.55"/>
  <text x="1265" y="443" text-anchor="middle" class="t-detail" style="font-weight:600;">VPCE: S3</text>
  <text x="1265" y="455" text-anchor="middle" class="t-detail">Gateway (FREE)</text>

  <!-- CloudWatch DR -->
  <rect x="1065" y="520" width="270" height="45" class="box-cw" opacity="0.55"/>
  <text x="1200" y="540" text-anchor="middle" class="t-label">CloudWatch</text>
  <text x="1200" y="554" text-anchor="middle" class="t-detail">Receives alarm · Monitors replica</text>

  <!-- Route53 → ALB DR (red dashed = failover) -->
  <path d="M 350 124 L 350 140 Q 750 148 900 200 L 900 243" class="arrow arrow-red arrow-dash"/>
  <text x="680" y="168" class="t-detail-dk" style="fill:#dc3545; font-weight:600;">Failover</text>

  <!-- ALB → Fargate DR -->
  <line x1="900" y1="303" x2="900" y2="363" class="arrow" opacity="0.5"/>

  <!-- Fargate → RDS DR -->
  <line x1="900" y1="447" x2="900" y2="508" class="arrow" opacity="0.5"/>

  <!-- ================================================================ -->
  <!-- CROSS-REGION REPLICATION                                         -->
  <!-- ================================================================ -->
  <path d="M 312 540 Q 550 620 788 540" class="arrow-repl"/>
  <text x="550" y="610" text-anchor="middle" class="t-detail-dk" style="fill:#1a73e8; font-weight:600; font-size:11px;">Async Cross-Region Replication</text>

  <!-- CloudWatch → Route53 failover trigger -->
  <path d="M 502 490 Q 502 470 430 150 L 380 124" class="arrow arrow-red arrow-dash" style="stroke-width:1.5;"/>
  <text x="418" y="142" class="t-detail-dk" style="fill:#dc3545;">Health check</text>

  <!-- ================================================================ -->
  <!-- LEGEND                                                           -->
  <!-- ================================================================ -->
  <rect x="30" y="700" width="520" height="330" fill="#fff" stroke="#dee2e6" stroke-width="1" rx="6"/>
  <text x="50" y="726" class="t-legend-h">Legend</text>

  <rect x="50" y="740" width="14" height="14" fill="#d4edda" stroke="#28a745" stroke-width="1"/>
  <text x="72" y="752" class="t-legend">Public Subnet (ALB)</text>

  <rect x="50" y="762" width="14" height="14" fill="#fff8e1" stroke="#f9a825" stroke-width="1"/>
  <text x="72" y="774" class="t-legend">Private Subnet (Fargate, RDS, VPC Endpoints)</text>

  <line x1="50" y1="793" x2="80" y2="793" class="arrow arrow-green" style="stroke-width:2;"/>
  <text x="88" y="797" class="t-legend">Active traffic (primary)</text>

  <line x1="50" y1="813" x2="80" y2="813" class="arrow arrow-red arrow-dash" style="stroke-width:2;"/>
  <text x="88" y="817" class="t-legend">Failover path (on health-check alarm)</text>

  <line x1="50" y1="833" x2="80" y2="833" class="arrow-repl"/>
  <text x="88" y="837" class="t-legend">Async RDS replication</text>

  <line x1="50" y1="853" x2="80" y2="853" class="arrow arrow-orange" style="stroke-width:2;"/>
  <text x="88" y="857" class="t-legend">VPC Endpoint connectivity</text>

  <!-- Cost box -->
  <text x="50" y="888" class="t-legend-h">2-Day Cost Estimate (both regions)</text>
  <text x="50" y="906" class="t-cost">Fargate (0.25 vCPU, 0.5 GB × 2 regions) .............. ~$1.50</text>
  <text x="50" y="920" class="t-cost">RDS db.t4g.micro (primary + replica) ...................... ~$2.00</text>
  <text x="50" y="934" class="t-cost">ALB (× 2 regions) ...................................................... ~$2.00</text>
  <text x="50" y="948" class="t-cost">Route 53 (hosted zone + health checks) .................. ~$1.50</text>
  <text x="50" y="962" class="t-cost">ACM ............................................................................ Free</text>
  <text x="50" y="980" class="t-cost" style="font-weight:700; font-size:10px;">Total ≈ $7–8    (destroyed after screenshot collection)</text>

  <!-- Architecture note -->
  <text x="50" y="1010" class="t-legend-h">Key Decisions</text>
  <text x="50" y="1026" class="t-cost">• VPC Endpoints instead of NAT Gateways → saves ~$15/month</text>

  <!-- ================================================================ -->
  <!-- FLOW ANNOTATIONS                                                 -->
  <!-- ================================================================ -->
  <rect x="600" y="700" width="370" height="175" fill="#fff" stroke="#dee2e6" stroke-width="1" rx="6"/>
  <text x="620" y="726" class="t-legend-h">Normal Operation</text>
  <text x="620" y="745" class="t-legend">1. Route 53 resolves awscloudcase.com → Primary ALB</text>
  <text x="620" y="762" class="t-legend">2. ALB terminates TLS (ACM) → forwards to Fargate</text>
  <text x="620" y="779" class="t-legend">3. Flask app queries RDS PostgreSQL (24 tables)</text>
  <text x="620" y="796" class="t-legend">4. Admin enters results → points + rankings update</text>

  <text x="620" y="825" class="t-legend-h" style="fill:#dc3545;">Disaster Recovery</text>
  <text x="620" y="844" class="t-legend">1. CloudWatch health check detects primary failure</text>
  <text x="620" y="861" class="t-legend">2. Route 53 failover → DR region ALB</text>
  <text x="620" y="878" class="t-legend">3. RDS read replica promoted to standalone primary</text>

  <!-- ================================================================ -->
  <!-- DB DETAIL BOX                                                    -->
  <!-- ================================================================ -->
  <rect x="1020" y="700" width="350" height="175" fill="#fff" stroke="#dee2e6" stroke-width="1" rx="6"/>
  <text x="1040" y="726" class="t-legend-h">Database — itf_tournament</text>
  <text x="1040" y="745" class="t-legend">24 normalised tables · PostgreSQL 16</text>
  <text x="1040" y="762" class="t-legend">15 prerequisite (reference) + 8 generated</text>
  <text x="1040" y="779" class="t-legend">59 tournaments · 6,666+ matches</text>
  <text x="1040" y="796" class="t-legend">Best 4 results over previous 52 weeks</text>
  <text x="1040" y="813" class="t-legend">4 age/gender categories: M60 · F60 · M65 · F65</text>
  <text x="1040" y="838" class="t-legend-h">Tech Stack</text>
  <text x="1040" y="856" class="t-legend">Python · Flask · Jinja2 · psycopg2</text>
  <text x="1040" y="873" class="t-legend">Terraform · Docker · AWS Fargate · RDS</text>

  <!-- Footer -->
  <text x="700" y="1038" text-anchor="middle" class="t-sub" style="font-size:11px;">ITF Masters Tour — Designed and implemented by Malik Hamdane — 2026</text>
</svg>
